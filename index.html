<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G.G Demon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/peerjs@1.5.0/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="styles/main.css">
</head>

<body class="bg-slate-950 select-none">

    <!-- Screen 0: Title -->
    <div id="title-screen" class="fixed inset-0 z-[200] flex flex-col items-center justify-center p-6 bg-slate-950">
        <div class="flex flex-col items-center mb-10 text-center text-white">
            <h1
                class="font-orbitron text-5xl md:text-7xl font-black italic bg-gradient-to-r from-emerald-400 via-sky-400 to-rose-400 bg-clip-text text-transparent title-glow uppercase px-4">
                G.G</h1>
            <h1
                class="font-orbitron text-6xl md:text-8xl font-black italic bg-gradient-to-r from-rose-400 via-sky-400 to-emerald-400 bg-clip-text text-transparent title-glow uppercase px-4">
                Demon</h1>
            <p class="mt-4 font-orbitron text-slate-600 font-bold tracking-[0.5em] text-xs uppercase text-slate-500">
                Master Edition</p>
        </div>

        <div class="flex flex-col space-y-4 w-full max-w-[280px] mb-12">
            <button onclick="goToSelection('normal')"
                class="bg-white text-slate-950 py-5 rounded-2xl font-black font-orbitron text-2xl hover:scale-105 active:scale-95 transition-all shadow-xl uppercase">VSCPU</button>
            <button onclick="goToSelection('tower')"
                class="bg-rose-600 text-white py-5 rounded-2xl font-black font-orbitron text-xl hover:scale-105 active:scale-95 transition-all shadow-xl uppercase border-b-4 border-rose-800">TOWER</button>
            <button onclick="showOnlineMenu()"
                class="bg-blue-600 text-white py-5 rounded-2xl font-black font-orbitron text-xl hover:scale-105 active:scale-95 transition-all shadow-xl uppercase border-b-4 border-blue-800">ONLINE
                VS</button>
            <button onclick="showTutorial()"
                class="bg-slate-800 text-slate-300 py-4 rounded-2xl font-black font-orbitron text-lg hover:bg-slate-700 active:scale-95 transition-all uppercase w-full">How
                to Play</button>
        </div>

        <div class="w-full max-w-[280px] bg-slate-900/50 p-4 rounded-3xl border border-slate-800">
            <div class="flex items-center w-full gap-4 text-white">
                <button id="title-sound-btn" onclick="toggleMute()"
                    class="p-3 bg-slate-800 border-2 border-slate-700 rounded-2xl transition-all">
                    <i id="title-mute-icon" data-lucide="volume-x" class="w-6 h-6"></i>
                </button>
                <div class="flex-1">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-[9px] font-black text-slate-500 font-orbitron uppercase text-slate-400">Master
                            Volume</span>
                        <span class="sync-vol-text text-[9px] font-black text-sky-400 font-orbitron">50%</span>
                    </div>
                    <input type="range" min="0" max="100" value="50" class="vol-slider sync-vol-slider"
                        oninput="changeVolume(this.value)">
                </div>
            </div>
        </div>
    </div>

    <!-- Screen 1: Selection Phase -->
    <div id="select-screen"
        class="fixed inset-0 z-[100] flex flex-col items-center justify-start p-6 bg-slate-950 hidden text-white">
        <h2 id="select-title"
            class="text-2xl font-black font-orbitron text-center mt-6 mb-8 bg-gradient-to-r from-emerald-400 via-sky-400 to-rose-400 bg-clip-text text-transparent italic tracking-tighter uppercase">
            Select Your Hero</h2>
        <div id="difficulty-selector" class="hidden w-full max-w-xl flex gap-3 mb-6">
            <button onclick="setAiLevel('EASY')" class="level-btn bg-slate-800 text-emerald-400"
                id="lvl-EASY">EASY</button>
            <button onclick="setAiLevel('NORMAL')" class="level-btn bg-slate-800 text-sky-400 selected"
                id="lvl-NORMAL">NORMAL</button>
            <button onclick="setAiLevel('HARD')" class="level-btn bg-slate-800 text-rose-400"
                id="lvl-HARD">HARD</button>
        </div>
        <div class="grid grid-cols-2 gap-3 w-full max-w-xl overflow-y-auto pb-10" id="char-grid"
            style="scrollbar-width: none;"></div>
    </div>

    <div id="tutorial-screen"
        class="fixed inset-0 z-[150] flex items-center justify-center p-4 bg-slate-950/90 backdrop-blur-sm hidden opacity-0 transition-opacity duration-300">
        <div
            class="relative w-full max-w-2xl bg-slate-900 border border-slate-800 rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">

            <!-- Header -->
            <header class="flex justify-between items-center p-6 bg-slate-900/50 border-b border-slate-800 shrink-0">
                <div>
                    <h2
                        class="text-2xl font-black italic bg-gradient-to-r from-sky-400 to-emerald-400 bg-clip-text text-transparent font-orbitron">
                        TACTICAL MANUAL
                    </h2>
                    <p class="text-xs text-slate-500 font-bold uppercase tracking-widest mt-1">G.G Demon Master Edition
                    </p>
                </div>
                <button onclick="hideTutorial()"
                    class="p-2 hover:bg-slate-800 rounded-full text-slate-400 transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </header>

            <!-- Tabs -->
            <div class="flex border-b border-slate-800 bg-slate-900/30 overflow-x-auto" style="scrollbar-width: none;">
                <button onclick="switchManualTab('basic')" id="tab-btn-basic"
                    class="tab-btn flex items-center gap-2 px-4 py-3 font-bold transition-all border-b-2 border-emerald-400 text-emerald-400 bg-emerald-400/5 shrink-0">
                    <i data-lucide="help-circle" class="w-4 h-4"></i>
                    <span class="text-sm uppercase tracking-wider">基本</span>
                </button>
                <button onclick="switchManualTab('commands')" id="tab-btn-commands"
                    class="tab-btn flex items-center gap-2 px-4 py-3 font-bold transition-all border-b-2 border-transparent text-slate-400 hover:text-slate-200 shrink-0">
                    <i data-lucide="zap" class="w-4 h-4"></i>
                    <span class="text-sm uppercase tracking-wider">コマンド</span>
                </button>
                <button onclick="switchManualTab('strategy')" id="tab-btn-strategy"
                    class="tab-btn flex items-center gap-2 px-4 py-3 font-bold transition-all border-b-2 border-transparent text-slate-400 hover:text-slate-200 shrink-0">
                    <i data-lucide="arrow-right-left" class="w-4 h-4"></i>
                    <span class="text-sm uppercase tracking-wider">相性</span>
                </button>
                <button onclick="switchManualTab('tower')" id="tab-btn-tower"
                    class="tab-btn flex items-center gap-2 px-4 py-3 font-bold transition-all border-b-2 border-transparent text-slate-400 hover:text-slate-200 shrink-0">
                    <i data-lucide="trophy" class="w-4 h-4"></i>
                    <span class="text-sm uppercase tracking-wider">タワー</span>
                </button>
            </div>

            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto p-6 space-y-8 bg-slate-950/30">

                <!-- Tab: Basic -->
                <div id="tab-content-basic" class="tab-content space-y-6">
                    <div class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                        <h3 class="text-emerald-400 font-black mb-4 flex items-center gap-2 text-lg">
                            <i data-lucide="target" class="w-5 h-5"></i> 勝利条件は2つ
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-rose-500/10 border border-rose-500/20 p-4 rounded-xl">
                                <div class="flex items-center gap-2 text-rose-400 font-bold mb-2">
                                    <i data-lucide="heart" class="w-4 h-4 fill-current"></i> KO勝利
                                </div>
                                <p class="text-sm text-slate-300">相手を攻撃し、<span
                                        class="text-white font-bold">HPを0</span>にすれば勝利！</p>
                            </div>
                            <div class="bg-sky-500/10 border border-sky-500/20 p-4 rounded-xl">
                                <div class="flex items-center gap-2 text-sky-400 font-bold mb-2">
                                    <i data-lucide="trending-up" class="w-4 h-4"></i> エナジー勝利
                                </div>
                                <p class="text-sm text-slate-300">エナジーをチャージし、<span
                                        class="text-white font-bold">WinE</span>に到達すれば勝利！</p>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-start gap-4 p-4 bg-slate-800/30 rounded-xl">
                        <div class="bg-slate-700 p-2 rounded-lg text-emerald-400 shrink-0">
                            <i data-lucide="info" class="w-5 h-5"></i>
                        </div>
                        <p class="text-sm text-slate-400 leading-relaxed font-medium">
                            毎ターン、互いにコマンドを1つ選び、<span class="text-slate-200 font-bold">同時に公開</span>します。
                            相手の行動を読み、どちらの勝利条件を狙うかが戦略の鍵です。
                        </p>
                    </div>
                </div>

                <!-- Tab: Commands -->
                <div id="tab-content-commands" class="tab-content space-y-4 hidden">
                    <!-- Charge -->
                    <div class="flex gap-4 p-4 bg-slate-800/50 rounded-2xl border border-slate-700 items-center">
                        <div class="bg-emerald-400/10 text-emerald-400 p-4 rounded-xl shadow-inner shrink-0">
                            <i data-lucide="zap" class="w-6 h-6"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-black tracking-tighter text-emerald-400 text-lg">CHARGE</span>
                                <span
                                    class="text-[10px] bg-slate-700 px-2 py-0.5 rounded text-slate-300 font-bold uppercase">Cost:
                                    0</span>
                            </div>
                            <p class="text-xs text-slate-300 leading-relaxed font-medium">エネルギーを溜めます。増加量はキャラのChgEに依存します。
                            </p>
                        </div>
                    </div>
                    <!-- Attack -->
                    <div class="flex gap-4 p-4 bg-slate-800/50 rounded-2xl border border-slate-700 items-center">
                        <div class="bg-rose-400/10 text-rose-400 p-4 rounded-xl shadow-inner shrink-0">
                            <i data-lucide="sword" class="w-6 h-6"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-black tracking-tighter text-rose-400 text-lg">ATTACK</span>
                                <span
                                    class="text-[10px] bg-slate-700 px-2 py-0.5 rounded text-slate-300 font-bold uppercase">Cost:
                                    1〜</span>
                            </div>
                            <p class="text-xs text-slate-300 leading-relaxed font-medium">
                                エナジーを消費して攻撃。相手がチャージ中なら一方的にダメージ！</p>
                        </div>
                    </div>
                    <!-- Guard -->
                    <div class="flex gap-4 p-4 bg-slate-800/50 rounded-2xl border border-slate-700 items-center">
                        <div class="bg-sky-400/10 text-sky-400 p-4 rounded-xl shadow-inner shrink-0">
                            <i data-lucide="shield" class="w-6 h-6"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-black tracking-tighter text-sky-400 text-lg">GUARD</span>
                                <span
                                    class="text-[10px] bg-slate-700 px-2 py-0.5 rounded text-slate-300 font-bold uppercase">Cost:
                                    0〜</span>
                            </div>
                            <p class="text-xs text-slate-300 leading-relaxed font-medium">相手のATTACKを完全に無効化します。</p>
                        </div>
                    </div>
                    <!-- Skill -->
                    <div class="flex gap-4 p-4 bg-slate-800/50 rounded-2xl border border-slate-700 items-center">
                        <div class="bg-purple-400/10 text-purple-400 p-4 rounded-xl shadow-inner shrink-0">
                            <i data-lucide="star" class="w-6 h-6"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-black tracking-tighter text-purple-400 text-lg">SKILL</span>
                                <span
                                    class="text-[10px] bg-slate-700 px-2 py-0.5 rounded text-slate-300 font-bold uppercase">Cost:
                                    Var</span>
                            </div>
                            <p class="text-xs text-slate-300 leading-relaxed font-medium">特殊な効果を発動します。強力ですがコストも必要です。</p>
                        </div>
                    </div>
                </div>

                <!-- Tab: Strategy -->
                <div id="tab-content-strategy" class="tab-content space-y-6 hidden">
                    <h3 class="text-slate-200 font-bold text-center mb-4 text-sm uppercase tracking-widest">三すくみの関係</h3>

                    <div class="relative h-64 flex items-center justify-center select-none">
                        <!-- Visual Representation -->
                        <div class="absolute top-0 flex flex-col items-center z-10">
                            <div
                                class="bg-rose-500/20 p-4 rounded-full border-2 border-rose-500 text-rose-500 shadow-[0_0_15px_rgba(244,63,94,0.4)]">
                                <i data-lucide="sword" class="w-8 h-8"></i>
                            </div>
                            <span
                                class="text-[10px] font-bold mt-2 text-rose-400 uppercase tracking-wider">Attack</span>
                        </div>
                        <div class="absolute bottom-0 left-10 flex flex-col items-center z-10">
                            <div
                                class="bg-emerald-500/20 p-4 rounded-full border-2 border-emerald-500 text-emerald-500 shadow-[0_0_15px_rgba(16,185,129,0.4)]">
                                <i data-lucide="zap" class="w-8 h-8"></i>
                            </div>
                            <span
                                class="text-[10px] font-bold mt-2 text-emerald-400 uppercase tracking-wider">Charge</span>
                        </div>
                        <div class="absolute bottom-0 right-10 flex flex-col items-center z-10">
                            <div
                                class="bg-sky-500/20 p-4 rounded-full border-2 border-sky-500 text-sky-500 shadow-[0_0_15px_rgba(14,165,233,0.4)]">
                                <i data-lucide="shield" class="w-8 h-8"></i>
                            </div>
                            <span class="text-[10px] font-bold mt-2 text-sky-400 uppercase tracking-wider">Guard</span>
                        </div>

                        <!-- Arrows SVG -->
                        <svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 200 200">
                            <defs>
                                <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto"
                                    markerUnits="strokeWidth">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#64748b" />
                                </marker>
                            </defs>
                            <!-- Attack beats Charge -->
                            <path d="M80 60 L60 140" fill="none" stroke="#64748b" stroke-width="2"
                                marker-end="url(#arrow)" />
                            <text x="50" y="105" fill="#f43f5e" font-size="10" font-weight="bold"
                                class="font-orbitron italic">BEATS</text>

                            <!-- Charge beats Guard -->
                            <path d="M70 170 L130 170" fill="none" stroke="#64748b" stroke-width="2"
                                marker-end="url(#arrow)" />
                            <text x="85" y="185" fill="#10b981" font-size="10" font-weight="bold"
                                class="font-orbitron italic">FASTER</text>

                            <!-- Guard beats Attack -->
                            <path d="M140 140 L120 60" fill="none" stroke="#64748b" stroke-width="2"
                                marker-end="url(#arrow)" />
                            <text x="130" y="105" fill="#0ea5e9" font-size="10" font-weight="bold"
                                class="font-orbitron italic">BLOCKS</text>
                        </svg>
                    </div>

                    <div
                        class="bg-slate-800/50 p-4 rounded-xl text-xs space-y-3 text-slate-400 border border-slate-700 font-medium">
                        <p>● <strong class="text-rose-400">ATTACK</strong> は <strong
                                class="text-emerald-400">CHARGE</strong> 中の相手に大ダメージを与えます。</p>
                        <p>● <strong class="text-sky-400">GUARD</strong> は <strong class="text-rose-400">ATTACK</strong>
                            を防ぎますが、相手に <strong class="text-emerald-400">CHARGE</strong> される隙を与えます。</p>
                        <p>● 同じ行動同士の場合は、<strong class="text-white">ステータスの高い方</strong>が有利になります。</p>
                    </div>
                </div>

                <!-- Tab: Tower -->
                <div id="tab-content-tower" class="tab-content space-y-6 hidden">
                    <div class="bg-amber-500/10 p-6 rounded-2xl border border-amber-500/30">
                        <h3
                            class="text-amber-400 font-black mb-2 flex items-center gap-2 uppercase tracking-wider text-lg">
                            <i data-lucide="trophy" class="w-5 h-5"></i> Tower Mode
                        </h3>
                        <p class="text-sm text-slate-300 leading-relaxed mb-4 font-medium">
                            敵を倒し続け、塔の頂上を目指す連戦モード。
                            戦闘を繰り返すほど敵は強くなりますが、あなたも進化していきます。
                        </p>

                        <div class="grid grid-cols-2 gap-3 text-xs">
                            <div class="bg-slate-900/50 p-3 rounded-lg border border-slate-700">
                                <div class="text-amber-400 font-bold mb-1 underline">トレジャー</div>
                                <p class="text-slate-400 leading-relaxed">ステータス強化や強力なスキルの習得が可能です。</p>
                            </div>
                            <div class="bg-slate-900/50 p-3 rounded-lg border border-slate-700">
                                <div class="text-rose-400 font-bold mb-1 underline">ボスバトル</div>
                                <p class="text-slate-400 leading-relaxed">特殊な能力を持った強力なボスが立ちはだかります。</p>
                            </div>
                        </div>
                    </div>

                    <div class="p-4 bg-slate-800/30 rounded-xl">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-3 tracking-widest">攻略のアドバイス</h4>
                        <ul class="text-xs text-slate-300 space-y-2">
                            <li class="flex items-center gap-2">
                                <i data-lucide="chevron-right" class="w-3 h-3 text-emerald-400"></i>
                                短期決戦なら WinE (勝利エナジー) の低いヒーローが有利！
                            </li>
                            <li class="flex items-center gap-2">
                                <i data-lucide="chevron-right" class="w-3 h-3 text-emerald-400"></i>
                                高火力の敵には GUARD コストの低いヒーローで耐え凌げ！
                            </li>
                        </ul>
                    </div>
                </div>

            </div>

            <!-- Footer -->
            <footer class="p-6 bg-slate-950/50 border-t border-slate-800 shrink-0">
                <button onclick="hideTutorial()"
                    class="w-full py-4 bg-gradient-to-r from-emerald-500 to-sky-500 hover:from-emerald-400 hover:to-sky-400 text-slate-950 font-black rounded-xl transition-all shadow-lg active:scale-95 uppercase tracking-widest text-lg">
                    Understood
                </button>
            </footer>
        </div>
    </div>
    <!-- Screen: Online Connection -->
    <div id="online-screen"
        class="fixed inset-0 z-[120] flex flex-col items-center justify-center p-6 bg-slate-950 hidden text-white">
        <h2
            class="text-3xl font-black font-orbitron text-center mb-8 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent italic tracking-tighter uppercase">
            Online Battle</h2>

        <!-- Step 1: Mode Select -->
        <div id="online-step-1" class="flex flex-col space-y-4 w-full max-w-[280px]">
            <button onclick="setupOnline('HOST')"
                class="bg-emerald-600 text-white py-5 rounded-2xl font-black font-orbitron text-xl hover:scale-105 active:scale-95 transition-all shadow-xl uppercase">Create
                Room</button>
            <button onclick="setupOnline('CLIENT')"
                class="bg-sky-600 text-white py-5 rounded-2xl font-black font-orbitron text-xl hover:scale-105 active:scale-95 transition-all shadow-xl uppercase">Join
                Room</button>
            <button onclick="exitOnline()"
                class="bg-slate-800 text-slate-300 py-4 rounded-2xl font-black font-orbitron text-lg hover:bg-slate-700 active:scale-95 transition-all uppercase w-full">Back</button>
        </div>

        <!-- Step 2: Host Waiting -->
        <div id="online-step-host" class="hidden flex flex-col items-center w-full max-w-md">
            <p class="text-slate-400 font-bold mb-2 uppercase text-xs tracking-widest">Your Room ID</p>
            <div class="bg-slate-900 border-2 border-blue-500 rounded-xl p-6 mb-6 w-full text-center relative">
                <span id="host-id-display"
                    class="font-orbitron text-4xl font-black text-white tracking-widest text-shadow-glow">???</span>
                <p class="text-[10px] text-slate-500 mt-2">Share this ID with your opponent</p>
            </div>
            <div class="flex items-center gap-3 mb-8">
                <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                <span class="text-xs font-bold text-emerald-400 uppercase tracking-widest animate-pulse">Waiting for
                    opponent...</span>
            </div>
            <button onclick="exitOnline()"
                class="bg-slate-800 text-slate-300 py-3 px-8 rounded-xl font-black font-orbitron text-sm hover:bg-slate-700 active:scale-95 transition-all uppercase">Cancel</button>
        </div>

        <!-- Step 2: Client Join -->
        <div id="online-step-client" class="hidden flex flex-col items-center w-full max-w-md">
            <p class="text-slate-400 font-bold mb-2 uppercase text-xs tracking-widest">Enter Room ID</p>
            <input type="text" id="join-id-input" placeholder="e.g. gg-abcd"
                class="bg-slate-900 border-2 border-slate-700 rounded-xl p-4 mb-6 w-full text-center font-orbitron text-2xl font-bold text-white focus:border-blue-500 outline-none uppercase placeholder:text-slate-700">

            <button onclick="joinRoom()"
                class="w-full bg-blue-600 text-white py-4 rounded-xl font-black font-orbitron text-xl hover:scale-105 active:scale-95 transition-all shadow-xl uppercase mb-4">Connect</button>
            <button onclick="exitOnline()"
                class="bg-slate-800 text-slate-300 py-3 px-8 rounded-xl font-black font-orbitron text-sm hover:bg-slate-700 active:scale-95 transition-all uppercase">Cancel</button>
        </div>

        <!-- Step 3: Client Connecting -->
        <div id="online-step-connecting" class="hidden flex flex-col items-center w-full max-w-md">
            <div class="mb-6">
                <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
            </div>
            <p class="text-slate-400 font-bold mb-2 uppercase text-xs tracking-widest">Connecting to</p>
            <p id="connecting-room-id" class="font-orbitron text-2xl font-black text-white mb-6">gg-????</p>
            <div class="flex items-center gap-3 mb-8">
                <div class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></div>
                <span class="text-xs font-bold text-blue-400 uppercase tracking-widest animate-pulse">Searching for
                    opponent...</span>
            </div>
            <button onclick="exitOnline()"
                class="bg-slate-800 text-slate-300 py-3 px-8 rounded-xl font-black font-orbitron text-sm hover:bg-slate-700 active:scale-95 transition-all uppercase">Cancel</button>
        </div>
    </div>
    <div id="char-status-overlay" onclick="closeStatusOverlay()">
        <div class="status-overlay-content" onclick="event.stopPropagation()">
            <div id="status-display-box"
                class="bg-slate-900 border-4 border-slate-700 p-8 rounded-[3rem] shadow-2xl relative text-center">
                <button onclick="closeStatusOverlay()" class="absolute top-6 right-6 text-slate-500 hover:text-white"><i
                        data-lucide="x"></i></button>
                <div id="status-info-content"></div>
            </div>
        </div>
    </div>

    <!-- Pause Menu -->
    <div id="pause-overlay"
        class="fixed inset-0 z-[180] overlay-bg flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <div
            class="w-full max-w-xs flex flex-col space-y-4 p-8 bg-slate-900 border-4 border-slate-800 rounded-[3rem] shadow-2xl text-center">
            <h2 class="text-3xl font-black italic font-orbitron mb-2 text-white uppercase">Paused</h2>
            <div class="bg-slate-950/50 p-4 rounded-2xl border border-slate-800 mb-4 text-white">
                <div class="flex justify-between items-center mb-2">
                    <span
                        class="text-[10px] font-black text-slate-500 font-orbitron uppercase tracking-widest">Volume</span>
                    <span class="sync-vol-text text-[10px] font-black text-sky-400 font-orbitron">50%</span>
                </div>
                <input type="range" min="0" max="100" value="50" class="vol-slider sync-vol-slider"
                    oninput="changeVolume(this.value)">
            </div>
            <button onclick="togglePause()"
                class="w-full bg-emerald-600 text-white py-4 rounded-2xl font-black uppercase text-xl active:scale-95">続ける</button>
            <button onclick="retryGame()"
                class="w-full bg-sky-600 text-white py-4 rounded-2xl font-black uppercase text-xl active:scale-95">リトライ</button>
            <button onclick="restartApp()"
                class="w-full bg-slate-800 text-white py-4 rounded-2xl font-black uppercase text-xl active:scale-95">タイトルへ</button>
        </div>
    </div>

    <!-- Game Header UI -->
    <header class="w-full max-w-2xl mx-auto flex justify-between items-center p-4 z-30 flex-shrink-0">
        <div class="flex flex-col text-white">
            <h1
                class="text-xs font-black font-orbitron bg-gradient-to-r from-emerald-400 to-sky-400 bg-clip-text text-transparent uppercase tracking-wider">
                G.G Demon</h1>
            <div id="tower-indicator" class="hidden mt-1"><span
                    class="streak-badge text-[10px] font-orbitron uppercase tracking-widest text-white">FLOOR <span
                        id="current-floor-val">1</span> / BOSS IN <span id="boss-in-val">10</span></span></div>
        </div>
        <div class="flex gap-2">
            <button id="sound-btn" onclick="toggleMute()"
                class="p-2 bg-slate-900 border-2 border-slate-800 rounded-xl transition-all"><i id="mute-icon"
                    data-lucide="volume-x" class="w-5 h-5 text-white"></i></button>
            <button onclick="togglePause()" class="p-2 bg-slate-900 border-2 border-slate-800 rounded-xl"><i
                    data-lucide="pause" class="w-5 h-5 text-white"></i></button>
        </div>
    </header>

    <main class="flex-grow w-full max-w-4xl mx-auto flex flex-row items-center justify-around relative px-2">
        <!-- Player -->
        <div class="flex flex-col items-center w-1/3">
            <div id="player-card" onclick="openStatusOverlay('PLAYER')"
                class="char-card-clickable w-32 h-32 md:w-40 md:h-40 bg-blue-500/10 rounded-[2.5rem] border-4 border-blue-500/30 flex items-center justify-center shadow-2xl relative transition-all">
                <div id="player-icon-container"></div>
                <div class="absolute -top-6 left-0 right-0">
                    <div id="player-hp-text" class="hp-text uppercase">HP 0 / 0</div>
                    <div class="h-3 bg-slate-800 rounded-full overflow-hidden border border-slate-700 mt-1">
                        <div id="player-hp-bar" class="hp-fill h-full bg-emerald-500 w-full"></div>
                    </div>
                </div>
            </div>

            <div id="player-effects-display" class="flex gap-2 mt-2 h-6"></div>
            <div class="status-info-bar text-white"><i data-lucide="zap" class="w-3 h-3 text-emerald-400"></i><span
                    id="player-chge-val">1</span>
                <div class="status-info-divider"></div><i data-lucide="sword" class="w-3 h-3 text-rose-400"></i><span
                    id="player-atk-val">1</span>
                <div class="status-info-divider"></div><i data-lucide="battery"
                    class="w-3 h-3 text-yellow-400"></i><span id="player-cost-val">1</span>
            </div>
            <div id="player-energy-bar" class="flex flex-wrap gap-1 justify-center max-w-[140px]"></div>
            <span id="player-name-label"
                class="text-[10px] md:text-xs font-black text-blue-400 tracking-[0.2em] mt-3 uppercase font-orbitron italic text-center">PLAYER</span>
        </div>

        <div
            class="flex flex-col items-center justify-center z-20 w-1/4 h-full relative text-slate-800 pointer-events-none">
            <!-- コマンド詳細 -->
            <div id="command-detail-view"
                class="absolute top-1/2 -translate-y-3/4 w-full flex items-center justify-center z-50"></div>
        </div>



        <!-- CPU -->
        <div class="flex flex-col items-center w-1/3">
            <div id="cpu-card" onclick="openStatusOverlay('CPU')"
                class="char-card-clickable w-32 h-32 md:w-40 md:h-40 bg-rose-500/10 rounded-[2.5rem] border-4 border-rose-500/20 flex items-center justify-center shadow-2xl relative transition-all">
                <div id="cpu-icon-container"></div>
                <div class="absolute -top-6 left-0 right-0">
                    <div id="cpu-hp-text" class="hp-text uppercase">HP 0 / 0</div>
                    <div class="h-3 bg-slate-800 rounded-full overflow-hidden border border-slate-700 mt-1">
                        <div id="cpu-hp-bar" class="hp-fill h-full bg-rose-500 w-full"></div>
                    </div>
                </div>

                <div id="cpu-level-badge"
                    class="absolute -bottom-2 -right-2 bg-rose-600 text-white text-[8px] font-black px-2 py-0.5 rounded italic font-orbitron hidden uppercase tracking-widest">
                    LV.1</div>
            </div>
            <div id="cpu-effects-display" class="flex gap-2 mt-2 h-6"></div>
            <div class="status-info-bar text-white"><i data-lucide="zap" class="w-3 h-3 text-emerald-400"></i><span
                    id="cpu-chge-val">1</span>
                <div class="status-info-divider"></div><i data-lucide="sword" class="w-3 h-3 text-rose-400"></i><span
                    id="cpu-atk-val">1</span>
                <div class="status-info-divider"></div><i data-lucide="battery"
                    class="w-3 h-3 text-yellow-400"></i><span id="cpu-cost-val">1</span>
            </div>
            <div id="cpu-energy-bar" class="flex flex-wrap gap-1 justify-center max-w-[140px]"></div>
            <span id="cpu-name-label"
                class="text-[10px] md:text-xs font-black text-rose-500/60 tracking-[0.2em] mt-3 uppercase font-orbitron italic text-center">CPU</span>
        </div>
    </main>

    <!-- Footer Commands -->
    <footer id="footer-ui-container" class="flex-shrink-0">
        <div id="command-wrapper">
            <div id="game-message-container">
                <p id="game-message"
                    class="text-white font-black text-xl font-orbitron italic tracking-widest uppercase"></p>
            </div>

            <!-- Ready Button (Restored) -->
            <div class="w-full flex justify-center mb-2">
                <button id="btn-ready" onclick="confirmCommand()" disabled
                    class="ready-btn w-64 py-3 bg-white text-slate-950 rounded-xl font-black text-xl uppercase shadow-[0_0_20px_rgba(255,255,255,0.4)] transition-all active:scale-95 disabled:opacity-0 disabled:pointer-events-none font-orbitron tracking-widest hover:bg-slate-200">
                    Ready
                </button>
            </div>

            <!-- コマンドエリア -->
            <div class="flex space-x-3 items-end mb-4 pt-4">
                <button id="cmd-CHARGE" onclick="selectCommand('CHARGE')" class="command-btn btn-charge"><span
                        class="stat-badge" id="badge-charge-val">0</span><i data-lucide="zap" class="w-8 h-8"></i><span
                        class="effect-label" id="eff-charge">+1</span></button>
                <button id="cmd-ATTACK" onclick="selectCommand('ATTACK')" class="command-btn btn-attack"><span
                        class="stat-badge" id="badge-attack-val">1</span><i data-lucide="sword"
                        class="w-8 h-8"></i><span class="effect-label" id="eff-attack">1 DMG</span></button>
                <button id="cmd-GUARD" onclick="selectCommand('GUARD')" class="command-btn btn-guard"><span
                        class="stat-badge" id="badge-guard-val">0</span><i data-lucide="shield"
                        class="w-8 h-8"></i><span class="effect-label" id="eff-guard">BLOCK</span></button>
                <button id="cmd-SKILL" onclick="selectCommand('SKILL')" class="command-btn btn-skill"><span
                        class="stat-badge" id="badge-skill-val">?</span><i data-lucide="star" class="w-8 h-8"></i><span
                        class="effect-label" id="eff-skill">SKILL</span></button>
            </div>

            <div class="mt-2 font-orbitron text-[10px] font-black text-slate-700 tracking-[0.2em]">TURN <span
                    id="turn-display">1</span></div>
        </div>
    </footer>

    <!-- Result -->
    <div id="result-overlay"
        class="fixed inset-0 z-[150] overlay-bg flex items-center justify-center hidden opacity-0 transition-opacity duration-500">
        <div
            class="w-full max-w-xs flex flex-col items-center p-10 bg-slate-900 border-4 border-slate-800 rounded-[3rem] shadow-2xl text-center text-white">
            <h2 id="result-title" class="text-4xl font-black italic font-orbitron mb-4 uppercase tracking-tighter">
                Result</h2>
            <p id="result-desc" class="text-slate-400 mb-8 font-bold text-sm uppercase"></p>
            <div id="streak-result-box" class="mb-8 hidden">
                <div class="text-xs font-black text-slate-500 uppercase tracking-widest mb-1 font-orbitron">Win
                    Streak
                </div>
                <div id="final-streak-val" class="text-5xl font-black font-orbitron text-rose-500">0</div>
            </div>
            <button id="btn-next-stage" onclick="nextStage()"
                class="w-full bg-emerald-600 text-white py-4 rounded-xl font-black uppercase text-lg active:scale-95 mb-3 hidden uppercase">Next
                Enemy</button>
            <button onclick="restartApp()"
                class="w-full bg-white text-slate-950 py-4 rounded-xl font-black uppercase text-lg active:scale-95 transition-all">タイトルへ戻る</button>
        </div>
    </div>

    <!-- Battle Dialog Overlay -->
    <div id="battle-dialog-overlay"
        class="fixed inset-0 z-[100] overlay-bg flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <!-- Content injected by JS -->
    </div>

    <!-- Treasure Chest Overlay -->
    <div id="treasure-overlay"
        class="fixed inset-0 z-[160] overlay-bg flex-col items-center justify-start hidden opacity-0 transition-opacity duration-500 p-4 pt-12 pb-12 overflow-y-auto">
        <div class="flex flex-col items-center text-center mb-8">
            <i data-lucide="gem" class="w-16 h-16 text-amber-400 drop-shadow-[0_0_15px_rgba(251,191,36,0.7)] mb-3"></i>
            <h2 class="text-3xl font-black italic font-orbitron uppercase tracking-tighter text-white">Choose Your
                Reward</h2>
            <p class="text-slate-400 font-bold text-sm uppercase">Select one of three options</p>
        </div>
        <div id="treasure-cards-container" class="flex flex-col gap-4 w-full max-w-2xl justify-center items-center">
            <!-- Cards will be inserted here by JavaScript -->
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>

</html>