<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G.G Demon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="styles/main.css">
</head>

<body class="bg-slate-950 select-none">

    <!-- Screen 0: Title -->
    <div id="title-screen" class="fixed inset-0 z-[200] flex flex-col items-center justify-center p-6 bg-slate-950">
        <div class="flex flex-col items-center mb-10 text-center text-white">
            <h1
                class="font-orbitron text-5xl md:text-7xl font-black italic bg-gradient-to-r from-emerald-400 via-sky-400 to-rose-400 bg-clip-text text-transparent title-glow uppercase px-4">
                G.G</h1>
            <h1
                class="font-orbitron text-6xl md:text-8xl font-black italic bg-gradient-to-r from-rose-400 via-sky-400 to-emerald-400 bg-clip-text text-transparent title-glow uppercase px-4">
                Demon</h1>
            <p class="mt-4 font-orbitron text-slate-600 font-bold tracking-[0.5em] text-xs uppercase text-slate-500">
                Master Edition</p>
        </div>

        <div class="flex flex-col space-y-4 w-full max-w-[280px] mb-12">
            <button onclick="goToSelection('normal')"
                class="bg-white text-slate-950 py-5 rounded-2xl font-black font-orbitron text-2xl hover:scale-105 active:scale-95 transition-all shadow-xl uppercase">VSCPU</button>
            <button onclick="goToSelection('tower')"
                class="bg-rose-600 text-white py-5 rounded-2xl font-black font-orbitron text-xl hover:scale-105 active:scale-95 transition-all shadow-xl uppercase border-b-4 border-rose-800">TOWER</button>
            <button onclick="showTutorial()"
                class="bg-slate-800 text-slate-300 py-4 rounded-2xl font-black font-orbitron text-lg hover:bg-slate-700 active:scale-95 transition-all uppercase w-full">How
                to Play</button>
        </div>

        <div class="w-full max-w-[280px] bg-slate-900/50 p-4 rounded-3xl border border-slate-800">
            <div class="flex items-center w-full gap-4 text-white">
                <button id="title-sound-btn" onclick="toggleMute()"
                    class="p-3 bg-slate-800 border-2 border-slate-700 rounded-2xl transition-all">
                    <i id="title-mute-icon" data-lucide="volume-x" class="w-6 h-6"></i>
                </button>
                <div class="flex-1">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-[9px] font-black text-slate-500 font-orbitron uppercase text-slate-400">Master
                            Volume</span>
                        <span class="sync-vol-text text-[9px] font-black text-sky-400 font-orbitron">50%</span>
                    </div>
                    <input type="range" min="0" max="100" value="50" class="vol-slider sync-vol-slider"
                        oninput="changeVolume(this.value)">
                </div>
            </div>
        </div>
    </div>

    <!-- Screen 1: Selection Phase -->
    <div id="select-screen"
        class="fixed inset-0 z-[100] flex flex-col items-center justify-start p-6 bg-slate-950 hidden text-white">
        <h2 id="select-title"
            class="text-2xl font-black font-orbitron text-center mt-6 mb-8 bg-gradient-to-r from-emerald-400 via-sky-400 to-rose-400 bg-clip-text text-transparent italic tracking-tighter uppercase">
            Select Your Hero</h2>
        <div id="difficulty-selector" class="hidden w-full max-w-xl flex gap-3 mb-6">
            <button onclick="setAiLevel('EASY')" class="level-btn bg-slate-800 text-emerald-400"
                id="lvl-EASY">EASY</button>
            <button onclick="setAiLevel('NORMAL')" class="level-btn bg-slate-800 text-sky-400 selected"
                id="lvl-NORMAL">NORMAL</button>
            <button onclick="setAiLevel('HARD')" class="level-btn bg-slate-800 text-rose-400"
                id="lvl-HARD">HARD</button>
        </div>
        <div class="grid grid-cols-2 gap-3 w-full max-w-xl overflow-y-auto pb-10" id="char-grid"
            style="scrollbar-width: none;"></div>
    </div>

    <div id="tutorial-screen">
        <div class="tutorial-content">
            <header class="w-full flex justify-between items-center mb-8">
                <h2
                    class="text-2xl font-black font-orbitron italic bg-gradient-to-r from-sky-400 to-emerald-400 bg-clip-text text-transparent uppercase">
                    Manual</h2>
                <button onclick="hideTutorial()"
                    class="p-2 bg-slate-900 border-2 border-slate-800 rounded-xl text-white font-bold px-4 hover:bg-slate-800">CLOSE</button>
            </header>

            <section class="mb-8">
                <h3 class="text-emerald-400 font-black text-sm mb-3 uppercase tracking-widest font-orbitron">Basic Rule
                </h3>
                <div class="rule-card">
                    <p class="text-sm font-bold leading-relaxed text-slate-200">
                        ターンごとにコマンドを選び、相手と同時に公開します。<br>
                        <span class="text-rose-400 font-black">相手のHPを0にする</span> か、<br>
                        <span class="text-yellow-400 font-black">勝利必要エネルギー(WinE)を溜める</span> と勝利です。
                    </p>
                </div>
            </section>

            <section class="mb-8">
                <h3 class="text-sky-400 font-black text-sm mb-3 uppercase tracking-widest font-orbitron">Commands</h3>
                <div class="space-y-3">
                    <div class="flex items-start gap-3 bg-slate-900/50 p-3 rounded-xl border border-slate-800">
                        <i data-lucide="zap" class="w-5 h-5 text-emerald-400 mt-1"></i>
                        <p class="text-xs text-slate-300"><b>CHARGE:</b> エネルギーを獲得します。溜めるほど勝利に近づきます。</p>
                    </div>
                    <div class="flex items-start gap-3 bg-slate-900/50 p-3 rounded-xl border border-slate-800">
                        <i data-lucide="sword" class="w-5 h-5 text-rose-400 mt-1"></i>
                        <p class="text-xs text-slate-300"><b>ATTACK:</b>
                            エネルギーを消費して攻撃。相手がチャージ中なら大ダメージ。攻撃同士はATKが高い方が一方的に勝ちます。</p>
                    </div>
                    <div class="flex items-start gap-3 bg-slate-900/50 p-3 rounded-xl border border-slate-800">
                        <i data-lucide="shield" class="w-5 h-5 text-sky-400 mt-1"></i>
                        <p class="text-xs text-slate-300"><b>GUARD:</b> 相手の攻撃を無効化します。</p>
                    </div>
                    <div class="flex items-start gap-3 bg-slate-900/50 p-3 rounded-xl border border-slate-800">
                        <i data-lucide="star" class="w-5 h-5 text-purple-400 mt-1"></i>
                        <p class="text-xs text-slate-300"><b>SKILL:</b> 強力な特殊能力。TOWERモードでは報酬として新しいスキルを獲得できます。</p>
                    </div>
                </div>
            </section>

            <section class="mb-8">
                <h3 class="text-amber-400 font-black text-sm mb-3 uppercase tracking-widest font-orbitron">Tower Mode
                </h3>
                <div class="rule-card border-amber-500">
                    <p class="text-sm font-bold leading-relaxed text-slate-200">
                        敵を倒し続ける連戦モードです。数戦ごとに出現する宝箱で「ステータス強化」か「スキルの習得」を選択し、どこまで登れるか挑戦しましょう。
                    </p>
                </div>
            </section>
        </div>
    </div>

    <!-- Character Status Overlay -->
    <div id="char-status-overlay" onclick="closeStatusOverlay()">
        <div class="status-overlay-content" onclick="event.stopPropagation()">
            <div id="status-display-box"
                class="bg-slate-900 border-4 border-slate-700 p-8 rounded-[3rem] shadow-2xl relative text-center">
                <button onclick="closeStatusOverlay()" class="absolute top-6 right-6 text-slate-500 hover:text-white"><i
                        data-lucide="x"></i></button>
                <div id="status-info-content"></div>
            </div>
        </div>
    </div>

    <!-- Pause Menu -->
    <div id="pause-overlay"
        class="fixed inset-0 z-[180] overlay-bg flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <div
            class="w-full max-w-xs flex flex-col space-y-4 p-8 bg-slate-900 border-4 border-slate-800 rounded-[3rem] shadow-2xl text-center">
            <h2 class="text-3xl font-black italic font-orbitron mb-2 text-white uppercase">Paused</h2>
            <div class="bg-slate-950/50 p-4 rounded-2xl border border-slate-800 mb-4 text-white">
                <div class="flex justify-between items-center mb-2">
                    <span
                        class="text-[10px] font-black text-slate-500 font-orbitron uppercase tracking-widest">Volume</span>
                    <span class="sync-vol-text text-[10px] font-black text-sky-400 font-orbitron">50%</span>
                </div>
                <input type="range" min="0" max="100" value="50" class="vol-slider sync-vol-slider"
                    oninput="changeVolume(this.value)">
            </div>
            <button onclick="togglePause()"
                class="w-full bg-emerald-600 text-white py-4 rounded-2xl font-black uppercase text-xl active:scale-95">続ける</button>
            <button onclick="retryGame()"
                class="w-full bg-sky-600 text-white py-4 rounded-2xl font-black uppercase text-xl active:scale-95">リトライ</button>
            <button onclick="restartApp()"
                class="w-full bg-slate-800 text-white py-4 rounded-2xl font-black uppercase text-xl active:scale-95">タイトルへ</button>
        </div>
    </div>

    <!-- Game Header UI -->
    <header class="w-full max-w-2xl mx-auto flex justify-between items-center p-4 z-30 flex-shrink-0">
        <div class="flex flex-col text-white">
            <h1
                class="text-xs font-black font-orbitron bg-gradient-to-r from-emerald-400 to-sky-400 bg-clip-text text-transparent uppercase tracking-wider">
                G.G Demon</h1>
            <div id="tower-indicator" class="hidden mt-1"><span
                    class="streak-badge text-[10px] font-orbitron uppercase tracking-widest text-white">FLOOR <span
                        id="current-floor-val">1</span> / BOSS IN <span id="boss-in-val">10</span></span></div>
        </div>
        <div class="flex gap-2">
            <button id="sound-btn" onclick="toggleMute()"
                class="p-2 bg-slate-900 border-2 border-slate-800 rounded-xl transition-all"><i id="mute-icon"
                    data-lucide="volume-x" class="w-5 h-5 text-white"></i></button>
            <button onclick="togglePause()" class="p-2 bg-slate-900 border-2 border-slate-800 rounded-xl"><i
                    data-lucide="pause" class="w-5 h-5 text-white"></i></button>
        </div>
    </header>

    <main class="flex-grow w-full max-w-4xl mx-auto flex flex-row items-center justify-around relative px-2">
        <!-- Player -->
        <div class="flex flex-col items-center w-1/3">
            <div id="player-card" onclick="openStatusOverlay('PLAYER')"
                class="char-card-clickable w-32 h-32 md:w-40 md:h-40 bg-blue-500/10 rounded-[2.5rem] border-4 border-blue-500/30 flex items-center justify-center shadow-2xl relative transition-all">
                <div id="player-icon-container"></div>
                <div class="absolute -top-6 left-0 right-0">
                    <div id="player-hp-text" class="hp-text uppercase">HP 0 / 0</div>
                    <div class="h-3 bg-slate-800 rounded-full overflow-hidden border border-slate-700 mt-1">
                        <div id="player-hp-bar" class="hp-fill h-full bg-emerald-500 w-full"></div>
                    </div>
                </div>
            </div>

            <div id="player-effects-display" class="flex gap-2 mt-2 h-6"></div>
            <div class="status-info-bar text-white"><i data-lucide="zap" class="w-3 h-3 text-emerald-400"></i><span
                    id="player-chge-val">1</span>
                <div class="status-info-divider"></div><i data-lucide="sword" class="w-3 h-3 text-rose-400"></i><span
                    id="player-atk-val">1</span>
                <div class="status-info-divider"></div><i data-lucide="battery"
                    class="w-3 h-3 text-yellow-400"></i><span id="player-cost-val">1</span>
            </div>
            <div id="player-energy-bar" class="flex flex-wrap gap-1 justify-center max-w-[140px]"></div>
            <span id="player-name-label"
                class="text-[10px] md:text-xs font-black text-blue-400 tracking-[0.2em] mt-3 uppercase font-orbitron italic text-center">PLAYER</span>
        </div>

        <div
            class="flex flex-col items-center justify-center z-20 w-1/4 h-full relative text-slate-800 pointer-events-none">
            <!-- コマンド詳細 -->
            <div id="command-detail-view"
                class="absolute top-1/2 -translate-y-3/4 w-full flex items-center justify-center z-50"></div>
        </div>



        <!-- CPU -->
        <div class="flex flex-col items-center w-1/3">
            <div id="cpu-card" onclick="openStatusOverlay('CPU')"
                class="char-card-clickable w-32 h-32 md:w-40 md:h-40 bg-rose-500/10 rounded-[2.5rem] border-4 border-rose-500/20 flex items-center justify-center shadow-2xl relative transition-all">
                <div id="cpu-icon-container"></div>
                <div class="absolute -top-6 left-0 right-0">
                    <div id="cpu-hp-text" class="hp-text uppercase">HP 0 / 0</div>
                    <div class="h-3 bg-slate-800 rounded-full overflow-hidden border border-slate-700 mt-1">
                        <div id="cpu-hp-bar" class="hp-fill h-full bg-rose-500 w-full"></div>
                    </div>
                </div>

                <div id="cpu-level-badge"
                    class="absolute -bottom-2 -right-2 bg-rose-600 text-white text-[8px] font-black px-2 py-0.5 rounded italic font-orbitron hidden uppercase tracking-widest">
                    LV.1</div>
            </div>
            <div id="cpu-effects-display" class="flex gap-2 mt-2 h-6"></div>
            <div class="status-info-bar text-white"><i data-lucide="zap" class="w-3 h-3 text-emerald-400"></i><span
                    id="cpu-chge-val">1</span>
                <div class="status-info-divider"></div><i data-lucide="sword" class="w-3 h-3 text-rose-400"></i><span
                    id="cpu-atk-val">1</span>
                <div class="status-info-divider"></div><i data-lucide="battery"
                    class="w-3 h-3 text-yellow-400"></i><span id="cpu-cost-val">1</span>
            </div>
            <div id="cpu-energy-bar" class="flex flex-wrap gap-1 justify-center max-w-[140px]"></div>
            <span id="cpu-name-label"
                class="text-[10px] md:text-xs font-black text-rose-500/60 tracking-[0.2em] mt-3 uppercase font-orbitron italic text-center">CPU</span>
        </div>
    </main>

    <!-- Footer Commands -->
    <footer id="footer-ui-container" class="flex-shrink-0">
        <div id="command-wrapper">
            <div id="game-message-container">
                <p id="game-message"
                    class="text-white font-black text-xl font-orbitron italic tracking-widest uppercase"></p>
            </div>

            <!-- Ready Button (Restored) -->
            <div class="w-full flex justify-center mb-2">
                <button id="btn-ready" onclick="confirmCommand()" disabled
                    class="ready-btn w-64 py-3 bg-white text-slate-950 rounded-xl font-black text-xl uppercase shadow-[0_0_20px_rgba(255,255,255,0.4)] transition-all active:scale-95 disabled:opacity-0 disabled:pointer-events-none font-orbitron tracking-widest hover:bg-slate-200">
                    Ready
                </button>
            </div>

            <!-- コマンドエリア -->
            <div class="flex space-x-3 items-end mb-4 pt-4">
                <button id="cmd-CHARGE" onclick="selectCommand('CHARGE')" class="command-btn btn-charge"><span
                        class="stat-badge" id="badge-charge-val">0</span><i data-lucide="zap" class="w-8 h-8"></i><span
                        class="effect-label" id="eff-charge">+1</span></button>
                <button id="cmd-ATTACK" onclick="selectCommand('ATTACK')" class="command-btn btn-attack"><span
                        class="stat-badge" id="badge-attack-val">1</span><i data-lucide="sword"
                        class="w-8 h-8"></i><span class="effect-label" id="eff-attack">1 DMG</span></button>
                <button id="cmd-GUARD" onclick="selectCommand('GUARD')" class="command-btn btn-guard"><span
                        class="stat-badge" id="badge-guard-val">0</span><i data-lucide="shield"
                        class="w-8 h-8"></i><span class="effect-label" id="eff-guard">BLOCK</span></button>
                <button id="cmd-SKILL" onclick="selectCommand('SKILL')" class="command-btn btn-skill"><span
                        class="stat-badge" id="badge-skill-val">?</span><i data-lucide="star" class="w-8 h-8"></i><span
                        class="effect-label" id="eff-skill">SKILL</span></button>
            </div>

            <div class="mt-2 font-orbitron text-[10px] font-black text-slate-700 tracking-[0.2em]">TURN <span
                    id="turn-display">1</span></div>
        </div>
    </footer>

    <!-- Result -->
    <div id="result-overlay"
        class="fixed inset-0 z-[150] overlay-bg flex items-center justify-center hidden opacity-0 transition-opacity duration-500">
        <div
            class="w-full max-w-xs flex flex-col items-center p-10 bg-slate-900 border-4 border-slate-800 rounded-[3rem] shadow-2xl text-center text-white">
            <h2 id="result-title" class="text-4xl font-black italic font-orbitron mb-4 uppercase tracking-tighter">
                Result</h2>
            <p id="result-desc" class="text-slate-400 mb-8 font-bold text-sm uppercase"></p>
            <div id="streak-result-box" class="mb-8 hidden">
                <div class="text-xs font-black text-slate-500 uppercase tracking-widest mb-1 font-orbitron">Win Streak
                </div>
                <div id="final-streak-val" class="text-5xl font-black font-orbitron text-rose-500">0</div>
            </div>
            <button id="btn-next-stage" onclick="nextStage()"
                class="w-full bg-emerald-600 text-white py-4 rounded-xl font-black uppercase text-lg active:scale-95 mb-3 hidden uppercase">Next
                Enemy</button>
            <button onclick="restartApp()"
                class="w-full bg-white text-slate-950 py-4 rounded-xl font-black uppercase text-lg active:scale-95 transition-all">タイトルへ戻る</button>
        </div>
    </div>

    <!-- Battle Dialog Overlay -->
    <div id="battle-dialog-overlay"
        class="fixed inset-0 z-[100] overlay-bg flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <!-- Content injected by JS -->
    </div>

    <!-- Treasure Chest Overlay -->
    <div id="treasure-overlay"
        class="fixed inset-0 z-[160] overlay-bg flex-col items-center justify-start hidden opacity-0 transition-opacity duration-500 p-4 pt-12 pb-12 overflow-y-auto">
        <div class="flex flex-col items-center text-center mb-8">
            <i data-lucide="gem" class="w-16 h-16 text-amber-400 drop-shadow-[0_0_15px_rgba(251,191,36,0.7)] mb-3"></i>
            <h2 class="text-3xl font-black italic font-orbitron uppercase tracking-tighter text-white">Choose Your
                Reward</h2>
            <p class="text-slate-400 font-bold text-sm uppercase">Select one of three options</p>
        </div>
        <div id="treasure-cards-container" class="flex flex-col md:flex-row gap-4 w-full max-w-4xl justify-center">
            <!-- Cards will be inserted here by JavaScript -->
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>

</html>